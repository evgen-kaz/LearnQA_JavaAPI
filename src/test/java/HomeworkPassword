import io.restassured.RestAssured;
import io.restassured.response.Response;
import org.junit.jupiter.api.Test;


import java.util.*;

public class HomeworkPassword {
    @Test
    public void testRestAssured() {
        String[] listPassword = new String[]{"mustang", "password", "123456", "123456789", "12345678", "12345", "qwerty", "abc123", "12345",
                "football", "1234567", "monkey", "111111", "letmein", "1234", "1234567890", "dragon", "baseball", "sunshine", "iloveyou",
                "trustno1", "princess", "adobe123", "123123", "welcome", "login", "admin", "trustno1", "1234567890", "letmein", "solo",
                "1q2w3e4r", "sunshine", "letmein", "666666", "photoshop", "master", "1qaz2wsx", "qwertyuiop", "ashley", "123123", "121212",
                "starwars", "654321", "bailey", "access", "flower", "123123", "555555", "passw0rd", "shadow", "passw0rd", "monkey", "lovely",
                "ashley", "sunshine", "letmein", "654321", "7777777", "!@#$%^&*", "654321", "jesus", "password1", "hello", "charlie", "888888",
                "superman", "michael", "696969", "qwertyuiop", "hottie", "freedom", "aa123456", "qazwsx", "ninja", "azerty", "solo", "loveme",
                "whatever", "donald", "batman", "zaq1zaq1", "qazwsx", "Football", "000000", "starwars", "qwerty123", "123qwe"};

        Map<String, String> loginAndPassword = new HashMap<>();
        loginAndPassword.put("login", "super_admin");
        loginAndPassword.put("password", "secret_pass");

        //1-й запрос на - получение куки
        Response requestForGetCookie = RestAssured
                .given()
                .body(loginAndPassword)
                .when()
                .post("https://playground.learnqa.ru/ajax/api/get_secret_password_homework")
                .andReturn();
        String responseCookie = requestForGetCookie.getCookie("auth_cookie");
        System.out.println(responseCookie);

        Map<String, String> valueCookie = new HashMap<>();
        valueCookie.put("auth_cookie", responseCookie);

        //2-й запрос на проверку полученного куки
        Response requestResult = RestAssured
                .given()
                .cookies(valueCookie)
                .when()
                .post("https://playground.learnqa.ru/ajax/api/check_auth_cookie")
                .andReturn();
        String actualResult = requestResult.getBody().asString();
        String expectedResult = "You are authorized";
        if (actualResult.equals(expectedResult)) {
            requestResult.prettyPrint();
            System.out.println("Вы авторизовались");
        } else {
            System.out.println("Авторизация не произошла - неверный пароль. Пробуем еще, подождите.");
            
            for (String item : listPassword) { //перебираем весь список паролей
                Map<String, String> loginAndPassword2 = new HashMap<>();
                loginAndPassword2.put("login", "super_admin");
                loginAndPassword2.put("password", item);

                Response requestForGetCookie2 = RestAssured //получаем куки по логину и паролю
                        .given()
                        .body(loginAndPassword2)
                        .when()
                        .post("https://playground.learnqa.ru/ajax/api/get_secret_password_homework")
                        .andReturn();
                String responseCookie2 = requestForGetCookie2.getCookie("auth_cookie");
                //System.out.println(responseCookie2);


                Map<String, String> valueCookie2 = new HashMap<>(); //пытаемся авторизоваться с полученной куки
                valueCookie2.put("auth_cookie", responseCookie2);
                Response requestResult2 = RestAssured //кладем куки и проверяем авторизовались ли
                        .given()
                        .cookies(valueCookie2)
                        .when()
                        .post("https://playground.learnqa.ru/ajax/api/check_auth_cookie")
                        .andReturn();

                String actualResult1 = requestResult2.getBody().asString();
                String expectedResult1 = "You are authorized";
                if (actualResult1.equals(expectedResult1)) {
                    requestResult2.prettyPrint();
                    System.out.println("Верный пароль: " + item);
                    break;
                } 
            }
        }
    }
}
